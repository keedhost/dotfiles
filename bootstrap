#!/bin/bash

PACKAGES="git zsh vim fzf python3-pip"

read -p "This script will remove your current settings for zhs and vim. Do it? (yes/no) " yn

case $yn in 
	yes ) echo "OK, we will proceed";;
	no ) echo "Exiting...;
		exit 0;;
	* ) echo "Only \"yes\" or \"no\" accepts";;
esac

echo "Check if I have access to my GitHub private repos..."
ssh -T git@github.com 1> /dev/null 2>& 1
if [ $? -eq 0 ] ; then
	echo "Connection established. We can move forward"
else:
	echo "Coul'd not connect to the GitHub private repos."
	echo "Possible solutions:"
	echo "1. Check internet connections"
	echo "2. Check that SSH keys installed"
	echo "3. Check SSH keys permissions:"
	echo -e "\t chown -R $USER. ~/.ssh"
	echo -e"\t chmod 700 ~/.ssh"
	echo -e"\t chmod 600 ~/.ssh/*"
	echo -e"\t chmod 644 ~/.ssh/*.pub"
	echo "---------------------------------"
	exit 4
fi

install_packages () {
	OS="`uname`"
	case $OS in
	  	'Linux')
	    	OS='Linux'
	    	if [ -f /etc/redhat-release ]; then
               	Distro='RedHat'
	           	echo "Found $Distro $OS."
		       	sudo dnf install -y $1
    		elif [ -f /etc/SuSE-release ]; then
            	Distro='SuSe'
	            echo "Found $Distro $OS."
		    	sudo yum install -y $1
    		elif [ -f /etc/debian_version ]; then
            	Distro='Debian'
	            echo "Found $Distro $OS."
		    	sudo apt install -y $1
    		fi
	    	;;
	  	'FreeBSD')
	    	OS='FreeBSD'
	    	echo "Found $OS"
	    	su -c "pkg install $1"
	    	;;
	  	'WindowsNT')
	    	OS='Windows'
	    	echo "Found $OS"
	    	echo "Currently not supported by script"
	    	exit 2
	    	;;
	  	'Darwin') 
	    	OS='macOS'
	    	echo "Found $OS"
	    	brew install $1
	    	;;
	  	'SunOS')
	    	OS='Solaris'
	    	echo "Found $OS"
	    	echo "Currently not supported by script"
	    	exit 2
	    ;;
	  	*)
			echo "Unknown operation system. Exiting..."
			exit 3
		;;
	esac
}

install_packages $PACKAGES

echo "Start installing config files"
echo "Installing vim config"
mv -v ~/.vim ~/.vim-$(date +%d-%m-%Y-at-%H-%m)
rm -Rfv ~/.vim
git clone git@github.com:keedhost/vim.git ~/.vim
git clone https://github.com/gmarik/Vundle.vim.git ~/.vim/bundle/Vundle.vim
ln -sf ~/.vim/vimrc ~/.vimrc
vim +'PlugInstall --sync' +qa

echo "Installing zsh config"
mv -v ~/.zsh ~/.zsh-$(date +%d-%m-%Y-at-%H-%m)
git clone --recurse-submodules git@github.com:keedhost/zsh.git ~/.zsh --recursive --progress  --remote
ln -sf ~/.zsh/zshrc ~/.zshrc
python3 -m pip install thefuck
